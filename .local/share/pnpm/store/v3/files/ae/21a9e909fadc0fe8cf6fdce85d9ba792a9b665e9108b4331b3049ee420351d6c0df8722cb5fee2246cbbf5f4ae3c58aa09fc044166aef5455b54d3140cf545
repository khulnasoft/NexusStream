var e=require("node:path"),n=require("fs-extra"),t=require("json5"),r=require("globby"),o=require("node:fs"),u=require("depseek");function i(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=/*#__PURE__*/i(e),c=/*#__PURE__*/i(n),l=/*#__PURE__*/i(t);function a(){return a=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)}var f=function(e){var n=e.contents;return a({},e,{contents:0===n.trim().length?"\nexport {}\nexport default undefined\n":n})},d=function(e){return a({},e,{contents:e.contents.replace(/__dirname/g,"`${process.platform === 'win32' ? '' : '/'}${/file:\\/{2,3}(.+)\\/[^/]/.exec(import.meta.url)"+(e.isSource?"!":"")+"[1]}`")})},m=function(e){return a({},e,{contents:e.contents.replace(/__filename/g,"`${process.platform === 'win32' ? '' : '/'}${/file:\\/{2,3}(.+)/.exec(import.meta.url)"+(e.isSource?"!":"")+"[1]}`")})},p=function(e){return c.default.readFileSync(e,{encoding:"utf8"})},v=function(e,n){return c.default.outputFileSync(e,n,{encoding:"utf8"})},g=function(e){return l.default.parse(p(e))},x=function(e){return e?Array.isArray(e)?e:[e]:[]},b=c.default.unlinkSync,h=function(e){return e.replace(/\\/g,"/")},y=function n(t){var r=g(t);if(r.extends){var o=n(e.resolve(e.dirname(t),r.extends));return a({},o,r,{compilerOptions:a({},o.compilerOptions,r.compilerOptions)})}return r},j=function(e){var n=e.filename,t=e.filenames,r=e.options.cwd,o=e.ignore;return a({},e,{contents:u.patchRefs(e.contents,function(e){var u=e.endsWith("/")?e.slice(0,-1):e;return!u.includes("/")&&"."!==u&&".."!==u||o.includes(u)?e:P(n,u,t,r)})})},P=function(n,t,r,o){var u=e.dirname(n),i=e.resolve(o,"node_modules"),s=/^\..+\.[^./\\]+$/.test(t)?[t,t.replace(/\.[^./\\]+$/,"")]:[t],c=[".js",".cjs",".mjs"].reduce(function(e,n){return s.forEach(function(t){return e.push(""+t+n,t+"/index"+n)}),e},[]);return c.find(function(n){return r.includes(h(e.resolve(u,n)))})||c.find(function(n){return r.includes(h(e.resolve(i,n)))})||t},M=function(n){var t=n.contents,r=n.originName,o=n.filename;return a({},n,{contents:r===o?t:t.replace("//# sourceMappingURL="+e.basename(r)+".map","//# sourceMappingURL="+e.basename(o)+".map")})},w=function(e){var n=e.contents;return a({},e,{contents:n.includes("export default")?n:n+"\nexport default undefined\n"})},O=function(e){var n=e.options,t=e;return n.ext&&(t=j(t)),n.dirnameVar&&(t=d(t)),n.filenameVar&&(t=m(t)),n.fillBlank&&(t=f(t)),n.forceDefaultExport&&(t=w(t)),n.sourceMap&&(t=M(t)),t},_=function(n,t){return x(n).reduce(function(n,r){var o,u,i=y(e.resolve(t,r)),s=null==i||null==(o=i.compilerOptions)?void 0:o.outDir,c=null==i||null==(u=i.compilerOptions)||null==u.module.toLowerCase?void 0:u.module.toLowerCase();return s&&c.startsWith("es")?n.push(s):console.warn("tsconfig should declare `outDir` and `module` type es6 or above"),n},[])},S=function(n,t){if(!t)return n;var r=t;return r.includes("*")&&(r=r.slice(0,r.indexOf("*"))).includes("/")&&(r=r.slice(0,r.lastIndexOf("/"))),e.join(n,r)},k={cwd:process.cwd(),tsconfig:"./tsconfig.json",filenameVar:!0,dirnameVar:!0,ext:!0,unlink:!0,debug:function(){}},F=function(e,n){return e.map(function(e){return e.endsWith(".d.ts")?e:e.replace(/\.[^./\\]+$/,n)})};exports.DEFAULT_FIX_OPTIONS=k,exports.fix=function(n){try{var t=function(e){return a({},k,e,{debug:"function"==typeof(null==e?void 0:e.debug)?e.debug:!0===(null==e?void 0:e.debug)?console.log:k.debug})}(n);return Promise.resolve(function(n){try{var t=n.cwd,o=n.target,u=n.src,i=n.tsconfig,c=n.out,l=n.ext,a=n.debug,f=s.default.resolve(t,void 0===c?t:c),d=x(u),m=[].concat(x(o),_(i,t));a("debug:cwd",t),a("debug:outdir",f),a("debug:sources",d),a("debug:targets",m);var p=d.length>0;return Promise.resolve(function(e,n,t){return r.globby(function(e,n){return e.length>0?e.map(function(e){return e.includes("*")?e:e+"/**/*.{ts,tsx}"}):n.map(function(e){return e.includes("*")?e:e+"/**/*.{js,d.ts}"})}(e,n),{cwd:t,onlyFiles:!0,absolute:!0})}(d,m,t)).then(function(n){return Promise.resolve(function(n){try{return Promise.resolve(function(n){return r.globby(["node_modules/*/package.json","node_modules/@*/*/package.json"],{cwd:n,onlyFiles:!0,absolute:!0}).then(function(n){try{return Promise.resolve(Promise.all(n.map(function(n){try{return Promise.resolve(g(n)).then(function(t){var o=t.name,u=t.exports;if(!u)return{name:o};var i=e.dirname(n),s=function(e){var n=Object.entries(e),t=function e(n){return"string"==typeof n?[n]:Object.values(n).map(e).flat(2)};return"string"!=typeof e&&Object.keys(e).some(function(e){return e.startsWith(".")})?n.map(function(e){return[e[0],t(e[1])]}):[[".",t(e)]]}(u);return Promise.resolve(Promise.all(s.map(function(n){var t=n[0];return Promise.all(n[1].map(function(n){try{return Promise.resolve(r.globby(n,{cwd:i,onlyFiles:!0,absolute:!1})).then(function(r){return r.map(function(r){return e.join(r).replace(S(".",n),S(o,t))})})}catch(e){return Promise.reject(e)}}))}))).then(function(e){return{name:o,files:e.flat(2)}})})}catch(e){return Promise.reject(e)}}))).then(function(e){return e.reduce(function(e,n){var t,r=n.name,o=n.files;return r&&e.names.push(r),o&&(t=e.files).push.apply(t,o),e},{names:[],files:[]})})}catch(e){return Promise.reject(e)}})}(n)).then(function(e){var t=e.names,o=e.files;return Promise.resolve(r.globby(["!node_modules/.cache","!node_modules/.bin","!node_modules/**/node_modules"].concat(t.map(function(e){return"!node_modules/"+e}),["node_modules/**/*.(m|c)?js"]),{cwd:n,onlyFiles:!0,absolute:!0})).then(function(e){return{cjsModules:e,esmModules:o,allPackages:t}})})}catch(e){return Promise.reject(e)}}(t)).then(function(e){var t=e.cjsModules,r=e.esmModules,o=e.allPackages;a("debug:external-cjs-modules",t),a("debug:external-esm-modules",r);var u=[].concat(r,o),i="string"==typeof l?F(n,l):n,s=[].concat(t,i),c=[].concat(t,F(n,".js"));return a("debug:local-modules",i),{outDir:f,isSource:p,ignore:u,allJsModules:c,allModules:s,_localModules:i,localModules:n}})})}catch(e){return Promise.reject(e)}}(t)).then(function(e){return Promise.resolve(function(e,n){try{var t=n.cwd,r=n.unlink,u=n.sourceMap,i=e.outDir,c=e.isSource,l=e.ignore,a=e.allJsModules,f=e.allModules,d=e.localModules;return Promise.resolve(Promise.all(e._localModules.map(function(e,m){try{var x=e.endsWith(".d.ts")?a:f,y=d[m],j=(c?y:e).replace(h(t),h(i)),P=p(y),M=O({options:n,contents:P,isSource:c,ignore:l,filename:e,filenames:x,originName:y,nextName:j});return v(j,M.contents),!c&&r&&t===i&&j!==y&&b(y),u&&function(e,n,t){if(void 0===t&&(t=!1),e!==n){var r=e+".map";if(o.existsSync(r)){var u=n+".map",i=g(r);i.file=s.default.basename(n),v(u,JSON.stringify(i)),t&&b(r)}}}(y,j,r&&t===i),Promise.resolve()}catch(e){return Promise.reject(e)}}))).then(function(){})}catch(e){return Promise.reject(e)}}(e,t)).then(function(){})})}catch(e){return Promise.reject(e)}},exports.fixBlankFiles=function(e){return f({contents:e}).contents},exports.fixContents=function(e,n,t,r,o,u,i){return void 0===o&&(o=n),void 0===u&&(u=!1),void 0===i&&(i=[]),O({contents:e,filename:n,filenames:t,options:r,originName:o,isSource:u,ignore:i}).contents},exports.fixDefaultExport=function(e){return w({contents:e}).contents},exports.fixDirnameVar=function(e,n){return d({contents:e,isSource:n}).contents},exports.fixFilenameExtensions=F,exports.fixFilenameVar=function(e,n){return m({contents:e,isSource:n}).contents},exports.fixModuleReferences=function(e,n,t,r,o){return j({contents:e,filename:n,filenames:t,options:{cwd:r},ignore:o}).contents},exports.fixSourceMapRef=function(e,n,t){return M({contents:e,originName:n,filename:t}).contents};
//# sourceMappingURL=tsc-esm-fix.cjs.map
